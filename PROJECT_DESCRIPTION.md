# NetAdmin Bot v3.0 ‚Äî –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞](#–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
3. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-–∏-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏)
4. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
5. [–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å](#—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)
6. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
7. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
8. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ RBAC](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å-–∏-rbac)
9. [DevOps –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#devops-–∏-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
10. [–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å](#—Ç–µ–∫—É—â–∏–π-—Å—Ç–∞—Ç—É—Å)

---

## üéØ –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

**NetAdmin Bot v3.0** ‚Äî –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è IT-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∞—è:
- **Telegram-–±–æ—Ç** —Å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π –∏ RBAC
- **Redmine** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ –∏ —Ç–∏–∫–µ—Ç–∞–º–∏
- **Java Agent** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å MDaemon
- **Web Admin Panel** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** –∑–∞–¥–∞—á –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ **Role-Based Access Control (RBAC)** ‚Äî 7 —É—Ä–æ–≤–Ω–µ–π –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ **Telegram Topics Integration** ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–±–æ—á–∏—Ö –ø–æ—Ç–æ–∫–æ–≤ –ø–æ —Ç–µ–º–∞–º
- ‚úÖ **Dynamic Scheduling** ‚Äî –ø–µ—Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
- ‚úÖ **Event-Driven Architecture** ‚Äî Redis pub/sub –¥–ª—è –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
- ‚úÖ **Docker Compose** ‚Äî –ø–æ–ª–Ω–∞—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ **Production-Ready** ‚Äî healthchecks, backups, logging, error handling

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Telegram Supergroup                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Topic:  ‚îÇ  ‚îÇ  Topic:  ‚îÇ  ‚îÇ  Topic:  ‚îÇ  ‚îÇ  Topic:  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ Alerts   ‚îÇ  ‚îÇ Tickets  ‚îÇ  ‚îÇ Assets   ‚îÇ  ‚îÇ  Admin   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚ñº
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ   Python Bot (Aiogram)‚îÇ
            ‚îÇ   - RBAC Middleware   ‚îÇ
            ‚îÇ   - Topic Router      ‚îÇ
            ‚îÇ   - Redis Listener    ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ              ‚îÇ              ‚îÇ
        ‚ñº              ‚ñº              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Redis      ‚îÇ ‚îÇPostgreSQL‚îÇ ‚îÇ  Java Agent  ‚îÇ
‚îÇ  (Pub/Sub)   ‚îÇ ‚îÇ  (DB)    ‚îÇ ‚îÇ  (Spring)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ              ‚îÇ              ‚îÇ
       ‚îÇ              ‚îÇ              ‚îÇ
       ‚ñº              ‚ñº              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Admin Panel (FastAPI)               ‚îÇ
‚îÇ  - Docker Management                         ‚îÇ
‚îÇ  - Target CRUD                               ‚îÇ
‚îÇ  - Backup Management                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚ñº
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ   Redmine (Rails)    ‚îÇ
            ‚îÇ   - Issue Tracking   ‚îÇ
            ‚îÇ   - Plugins:         ‚îÇ
            ‚îÇ     ‚Ä¢ email_reports  ‚îÇ
            ‚îÇ     ‚Ä¢ issue_guard    ‚îÇ
            ‚îÇ     ‚Ä¢ recurring_tasks‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

1. **Telegram ‚Üí Bot ‚Üí Database**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É ‚Üí Middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª—å ‚Üí Handler –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
2. **Java Agent ‚Üí Redis ‚Üí Bot ‚Üí Telegram**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É ‚Üí –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Redis ‚Üí Bot –ø–æ–ª—É—á–∞–µ—Ç ‚Üí –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –Ω—É–∂–Ω—ã–π Topic
3. **Admin Panel ‚Üí Database ‚Üí Redis ‚Üí Java Agent**: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ target ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î ‚Üí –°–æ–±—ã—Ç–∏–µ –≤ Redis ‚Üí Java Agent –ø–µ—Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç schedule
4. **Redmine ‚Üí Webhooks ‚Üí Java Agent**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞ ‚Üí Webhook ‚Üí Java Agent –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

---

## üß© –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

### 1. Python Bot (`python-bot/`)

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- **Aiogram 3.3.0+** ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Telegram Bot API
- **SQLAlchemy 2.0.25+** ‚Äî ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL
- **asyncpg** ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä PostgreSQL
- **Redis 5.0.1+** ‚Äî –∫–ª–∏–µ–Ω—Ç –¥–ª—è pub/sub

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏:**
- `src/main.py` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è handlers, Redis listener
- `src/core/database.py` ‚Äî SQLAlchemy –º–æ–¥–µ–ª–∏ (`TelegramUser`, `TelegramTopic`, `UserRole` Enum)
- `src/core/middlewares.py` ‚Äî `RoleMiddleware` –¥–ª—è RBAC –ø—Ä–æ–≤–µ—Ä–æ–∫

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ä–æ–ª—å `USER` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ `flags={"role": UserRole.REQUIRED_ROLE}`
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram Topics –ø–æ `thread_id`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥: `/start`, `/admin`, `/set_topic`, `/cookie`, `WS\d+` (asset queries)
- –§–æ–Ω–æ–≤—ã–π worker –¥–ª—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è Redis –∫–∞–Ω–∞–ª–æ–≤ (`bot_alerts`, `netadmin_tasks`)

**–ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥:**
```python
@dp.message(Command("admin"), flags={"role": UserRole.SENIOR_ADMIN})
@dp.message(Command("set_topic"), flags={"role": UserRole.CTO})
```

---

### 2. Java Agent (`java-agent/`)

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- **Spring Boot 3.4.1** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **Spring Data JPA** ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –ë–î
- **Spring Data Redis** ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Redis
- **PostgreSQL Driver** ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
- **Java 21** ‚Äî LTS –≤–µ—Ä—Å–∏—è

**–û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:**
- `DynamicSchedulerService` ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
  - –ó–∞–≥—Ä—É–∂–∞–µ—Ç `MonitoredTarget` –∏–∑ –ë–î
  - –°–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç scheduled tasks –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  - –í—ã–ø–æ–ª–Ω—è–µ—Ç ping-–ø—Ä–æ–≤–µ—Ä–∫–∏ —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º
  - –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è (UP ‚Üí DOWN, DOWN ‚Üí UP)
  
- `AlertDispatcher` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ –≤ Redis
  - –§–æ—Ä–º–∞—Ç: `"TOPIC_NAME|MESSAGE"`
  - Python Bot –ø–æ–ª—É—á–∞–µ—Ç –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –≤ –Ω—É–∂–Ω—ã–π Telegram Topic
  
- `RedisEventListener` ‚Äî –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  - –°–ª—É—à–∞–µ—Ç –∫–∞–Ω–∞–ª `netadmin_events`
  - –ü—Ä–∏ —Å–æ–±—ã—Ç–∏–∏ `CONFIG_UPDATE:MONITORING` –≤—ã–∑—ã–≤–∞–µ—Ç `refreshSchedule()`

**–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö:**
- `MonitoredTarget` ‚Äî —Ö–æ—Å—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (name, hostname, interval_seconds, is_active, last_status, last_check)
- `TelegramTopic` ‚Äî –º–∞–ø–ø–∏–Ω–≥ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —Ç–æ–ø–∏–∫–æ–≤ –Ω–∞ thread_id

---

### 3. Admin Panel (`admin-panel/`)

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- **FastAPI** ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Python –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **Jinja2** ‚Äî —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä –¥–ª—è HTML
- **Docker SDK** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ (—á–µ—Ä–µ–∑ `/var/run/docker.sock`)
- **SQLAlchemy** ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ë–î
- **Redis** ‚Äî –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- **Dashboard** ‚Äî –æ–±–∑–æ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, targets, backups
- **Container Management** ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫, –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
- **Target CRUD** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ monitored targets
- **Backup Management** ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ backups
- **Simple Auth** ‚Äî cookie-based –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (MVP)

**Endpoints:**
- `GET /` ‚Äî dashboard
- `POST /login` ‚Äî –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `POST /api/containers/{id}/restart` ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- `GET /api/containers/{id}/logs` ‚Äî –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- `POST /api/targets` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ target
- `POST /api/targets/{id}/delete` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ target
- `GET /api/backups/download/{filename}` ‚Äî —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ backup

---

### 4. Redmine Service (`redmine-service/`)

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- **Redmine 6.0** (Rails-based)
- **PostgreSQL** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ë–î
- **Supervisor** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ (Rails server + background jobs)
- **Ruby Gems:**
  - `whenever` ‚Äî cron-like –∑–∞–¥–∞—á–∏
  - `chronic` ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏
  - `mail` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å email
  - `pg` ‚Äî –¥—Ä–∞–π–≤–µ—Ä PostgreSQL

**–ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã:**

1. **`email_reports`** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–æ–≤
   - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º
   - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (–¥–∞—Ç–∞, –ø—Ä–æ–µ–∫—Ç, —Ç—Ä–µ–∫–µ—Ä)
   - Email-—Ä–∞—Å—Å—ã–ª–∫–∞ –≥—Ä—É–ø–ø–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - Rake tasks –¥–ª—è –∑–∞–ø—É—Å–∫–∞: `rake email_reports:send_pending`

2. **`redmine_issue_guard`** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ issues
   - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ (spent time)
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
   - JavaScript –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ UI –¥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è

3. **`redmine_recurring_tasks`** (external) ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–∞–¥–∞—á
   - GitHub: `southbridgeio/redmine_recurring_tasks`

**Supervisor –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- Rails server (Puma) –Ω–∞ –ø–æ—Ä—Ç—É 3000
- Background jobs (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)

**Init Script (`init.sh`):**
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è mounted volumes
- –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î –∏ –ø–ª–∞–≥–∏–Ω–æ–≤
- –ó–∞–ø—É—Å–∫ Supervisor

---

### 5. Infrastructure Services

#### Nginx (`nginx/`)
- **–ü–æ—Ä—Ç:** 8081
- **–†–æ–ª—å:** Reverse proxy –¥–ª—è Redmine
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `config/nginx.conf`

#### PostgreSQL (`db/`)
- **–í–µ—Ä—Å–∏—è:** PostgreSQL 17 (Alpine)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** `netadmin_db`
- **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:** `config/init_rbac.sql` (—Å–æ–∑–¥–∞–Ω–∏–µ RBAC —Ç–∞–±–ª–∏—Ü)
- **Volumes:** `storage/postgresql-data`

#### Redis (`redis/`)
- **–í–µ—Ä—Å–∏—è:** Redis 7.4 (Alpine)
- **–†–æ–ª—å:** Message broker, cache
- **–ö–∞–Ω–∞–ª—ã:**
  - `bot_alerts` ‚Äî –∞–ª–µ—Ä—Ç—ã –æ—Ç Java Agent –∫ Python Bot
  - `netadmin_tasks` ‚Äî –∑–∞–¥–∞—á–∏ –¥–ª—è –±–æ—Ç–∞
  - `netadmin_events` ‚Äî —Å–æ–±—ã—Ç–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–¥–ª—è Java Agent)
- **Volumes:** `storage/redis-data`

#### Backup Service (`backup/`)
- **–†–æ–ª—å:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –ë–î –∏ —Ñ–∞–π–ª–æ–≤ Redmine
- **–°–∫—Ä–∏–ø—Ç:** `config/backup.sh`
- **Volumes:** `backups/`

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
PyBot/
‚îú‚îÄ‚îÄ admin-panel/              # Web Control Plane (FastAPI)
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ main.py
‚îÇ       ‚îî‚îÄ‚îÄ templates/
‚îÇ           ‚îú‚îÄ‚îÄ dashboard.html
‚îÇ           ‚îî‚îÄ‚îÄ login.html
‚îÇ
‚îú‚îÄ‚îÄ python-bot/               # Telegram Bot (Aiogram)
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ main.py
‚îÇ       ‚îî‚îÄ‚îÄ core/
‚îÇ           ‚îú‚îÄ‚îÄ database.py   # SQLAlchemy models
‚îÇ           ‚îî‚îÄ‚îÄ middlewares.py # RBAC middleware
‚îÇ
‚îú‚îÄ‚îÄ java-agent/               # Java Backend (Spring Boot)
‚îÇ   ‚îú‚îÄ‚îÄ pom.xml
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ src/main/java/com/netadmin/agent/
‚îÇ       ‚îú‚îÄ‚îÄ NetAdminAgentApplication.java
‚îÇ       ‚îú‚îÄ‚îÄ config/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ RedisConfig.java
‚îÇ       ‚îú‚îÄ‚îÄ model/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ MonitoredTarget.java
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ TelegramTopic.java
‚îÇ       ‚îú‚îÄ‚îÄ repository/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ MonitoredTargetRepository.java
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ TelegramTopicRepository.java
‚îÇ       ‚îî‚îÄ‚îÄ service/
‚îÇ           ‚îú‚îÄ‚îÄ DynamicSchedulerService.java
‚îÇ           ‚îú‚îÄ‚îÄ AlertDispatcher.java
‚îÇ           ‚îú‚îÄ‚îÄ RedisEventListener.java
‚îÇ           ‚îî‚îÄ‚îÄ TaskListener.java
‚îÇ
‚îú‚îÄ‚îÄ redmine-service/          # Redmine Customization
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ init.sh               # Entrypoint script
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ supervisord.conf
‚îÇ   ‚îî‚îÄ‚îÄ plugins/
‚îÇ       ‚îú‚îÄ‚îÄ email_reports/    # Custom plugin
‚îÇ       ‚îî‚îÄ‚îÄ redmine_issue_guard/ # Custom plugin
‚îÇ
‚îú‚îÄ‚îÄ config/                   # Configuration files
‚îÇ   ‚îú‚îÄ‚îÄ nginx.conf
‚îÇ   ‚îú‚îÄ‚îÄ database.yml          # Redmine DB config
‚îÇ   ‚îú‚îÄ‚îÄ configuration.yml     # Redmine app config
‚îÇ   ‚îú‚îÄ‚îÄ backup.sh
‚îÇ   ‚îî‚îÄ‚îÄ init_rbac.sql         # RBAC schema
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml        # Orchestration
‚îú‚îÄ‚îÄ Makefile                  # CLI shortcuts
‚îú‚îÄ‚îÄ env.example               # Environment template
‚îú‚îÄ‚îÄ .gitignore
‚îî‚îÄ‚îÄ README.md
```

---

## üé® –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### Phase 1: Core Infrastructure ‚úÖ
- [x] Docker Compose orchestration
- [x] Redmine —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø–ª–∞–≥–∏–Ω–∞–º–∏
- [x] PostgreSQL + Redis
- [x] Nginx reverse proxy
- [x] Backup service
- [x] Supervisor –¥–ª—è Redmine –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

### Phase 2: Web Control Plane & Dynamic Orchestration ‚úÖ
- [x] Admin Panel (FastAPI) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- [x] Docker container management —á–µ—Ä–µ–∑ API
- [x] CRUD –¥–ª—è monitored targets
- [x] Dynamic scheduling –≤ Java Agent
- [x] Redis event-driven –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Phase 3: Telegram Supergroup Integration (Topics & RBAC) ‚úÖ
- [x] RBAC —Å–∏—Å—Ç–µ–º–∞ (7 —É—Ä–æ–≤–Ω–µ–π: CREATOR, CTO, IT_HEAD, SENIOR_ADMIN, ADMIN, JUNIOR_ADMIN, USER)
- [x] Telegram Topics –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [x] RoleMiddleware –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤
- [x] Topic-based –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [x] Gamification (karma points —á–µ—Ä–µ–∑ `/cookie`)

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (Future Phases)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ–º –∞–∫—Ç–∏–≤–æ–≤ (asset queries)
- [ ] Weekly metrics –∏ leaderboard
- [ ] Redmine webhooks ‚Üí Java Agent
- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å
- [ ] Multi-language support

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞ RBAC

**–¢–∞–±–ª–∏—Ü–∞ `telegram_users`:**
```sql
CREATE TABLE telegram_users (
    id SERIAL PRIMARY KEY,
    telegram_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(255),
    role user_role DEFAULT 'USER',
    karma_points INT DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

**ENUM `user_role`:**
```sql
CREATE TYPE user_role AS ENUM (
    'CREATOR',      -- –í—ã—Å—à–∏–π —É—Ä–æ–≤–µ–Ω—å
    'CTO',
    'IT_HEAD',
    'SENIOR_ADMIN',
    'ADMIN',
    'JUNIOR_ADMIN',
    'USER'          -- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
);
```

**–¢–∞–±–ª–∏—Ü–∞ `telegram_topics`:**
```sql
CREATE TABLE telegram_topics (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) UNIQUE NOT NULL,  -- 'tickets', 'monitoring', etc.
    thread_id INT NOT NULL,            -- Telegram thread ID
    description VARCHAR(255)
);
```

**–ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–æ–ø–∏–∫–∏:**
- `tickets` ‚Äî Redmine Ticket Stream
- `assets` ‚Äî Asset Inventory Queries
- `metrics` ‚Äî Weekly Metrics & Leaderboard
- `monitoring` ‚Äî Infrastructure Alerts
- `admin` ‚Äî Bot Command Center

**–¢–∞–±–ª–∏—Ü–∞ `monitored_targets` (Admin Panel):**
```sql
CREATE TABLE monitored_targets (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255),
    hostname VARCHAR(255),
    interval_seconds INT DEFAULT 60,
    is_active BOOLEAN DEFAULT TRUE,
    last_status VARCHAR(50),
    last_check TIMESTAMP WITH TIME ZONE
);
```

---

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 1. Telegram Bot API
- **–ü—Ä–æ—Ç–æ–∫–æ–ª:** HTTPS Webhook/Polling
- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** Aiogram 3.3.0
- **–§—É–Ω–∫—Ü–∏–∏:** –ö–æ–º–∞–Ω–¥—ã, inline keyboards, topic routing

### 2. Redis Pub/Sub
- **–ö–∞–Ω–∞–ª—ã:**
  - `bot_alerts` ‚Äî —Ñ–æ—Ä–º–∞—Ç: `"TOPIC_NAME|MESSAGE"`
  - `netadmin_tasks` ‚Äî –∑–∞–¥–∞—á–∏ –¥–ª—è –±–æ—Ç–∞
  - `netadmin_events` ‚Äî —Å–æ–±—ã—Ç–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`CONFIG_UPDATE:MONITORING`)

### 3. PostgreSQL
- **–î—Ä–∞–π–≤–µ—Ä—ã:**
  - Python: `asyncpg` (async) –¥–ª—è –±–æ—Ç–∞, `psycopg2` (sync) –¥–ª—è admin panel
  - Java: `postgresql` JDBC driver
  - Ruby: `pg` gem –¥–ª—è Redmine

### 4. Docker API
- **–î–æ—Å—Ç—É–ø:** `/var/run/docker.sock` (mounted –≤ admin-panel)
- **–§—É–Ω–∫—Ü–∏–∏:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏, –ª–æ–≥–∏, —Å—Ç–∞—Ç—É—Å—ã

### 5. Redmine Plugins
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –ß–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Redmine plugin API
- **–ú–∏–≥—Ä–∞—Ü–∏–∏:** `rake redmine:plugins:migrate`

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ RBAC

### –ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–æ–ª–µ–π

–†–æ–ª–∏ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω—ã –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É (–Ω–∏–∂–µ = –≤—ã—à–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏):
1. **CREATOR** ‚Äî –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø, –º–æ–∂–µ—Ç –Ω–∞–∑–Ω–∞—á–∞—Ç—å —Ä–æ–ª–∏
2. **CTO** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–ø–∏–∫–∞–º–∏ (`/set_topic`)
3. **IT_HEAD** ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞
4. **SENIOR_ADMIN** ‚Äî –¥–æ—Å—Ç—É–ø –∫ `/admin`, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
5. **ADMIN** ‚Äî –±–∞–∑–æ–≤–æ–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
6. **JUNIOR_ADMIN** ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞
7. **USER** ‚Äî –±–∞–∑–æ–≤—ã–π –¥–æ—Å—Ç—É–ø (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤

**–í Python Bot:**
```python
@dp.message(Command("admin"), flags={"role": UserRole.SENIOR_ADMIN})
async def cmd_admin(message: Message, user: TelegramUser):
    # Handler –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ user.role >= SENIOR_ADMIN
    pass
```

**–í Middleware:**
```python
if user.role >= required_role:
    data["user"] = user
    return await handler(event, data)
else:
    await event.reply("‚õî Access Denied.")
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å Admin Panel

- **MVP Auth:** Cookie-based token (`admin_token=valid_token`)
- **‚ö†Ô∏è Production:** –¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–º–µ–Ω–∞ –Ω–∞ JWT/OAuth2
- **Docker Socket:** –ú–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º –æ —Ä–∏—Å–∫–∞—Ö

---

## üöÄ DevOps –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Docker Compose

**–°–µ—Ä–≤–∏—Å—ã:**
- `nginx` ‚Äî –ø–æ—Ä—Ç 8081
- `admin-panel` ‚Äî –ø–æ—Ä—Ç 8000
- `redmine` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç 3000
- `db` ‚Äî PostgreSQL 17
- `redis` ‚Äî Redis 7.4
- `backup` ‚Äî –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
- `python-bot` ‚Äî Telegram bot
- `java-agent` ‚Äî Spring Boot –Ω–∞ –ø–æ—Ä—Ç—É 8080

**Networks:**
- `bot_net` ‚Äî bridge network –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

**Volumes:**
- `storage/postgresql-data` ‚Äî –¥–∞–Ω–Ω—ã–µ –ë–î
- `storage/redis-data` ‚Äî –¥–∞–Ω–Ω—ã–µ Redis
- `storage/redmine/files` ‚Äî —Ñ–∞–π–ª—ã Redmine
- `storage/redmine/plugins` ‚Äî –ø–ª–∞–≥–∏–Ω—ã
- `storage/redmine/themes` ‚Äî —Ç–µ–º—ã
- `backups/` ‚Äî –±—ç–∫–∞–ø—ã
- `logs/` ‚Äî –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤

### Makefile –∫–æ–º–∞–Ω–¥—ã

**Docker Compose:**
```bash
make up          # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make down        # –û—Å—Ç–∞–Ω–æ–≤–∫–∞
make build       # –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤
make rebuild     # –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
make restart     # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
make logs        # –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make logs-bot    # –õ–æ–≥–∏ –±–æ—Ç–∞
make logs-redmine # –õ–æ–≥–∏ Redmine
make ps          # –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
make health      # Healthcheck —Å—Ç–∞—Ç—É—Å
```

**Git:**
```bash
make commit MSG="message"  # –ö–æ–º–º–∏—Ç
make push                  # Push
make save MSG="message"    # Commit + Push
```

**Utilities:**
```bash
make shell-bot      # Shell –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–æ—Ç–∞
make shell-db       # PostgreSQL shell
make backup         # –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
make redmine-migrate # –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ Redmine
```

### Healthchecks

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏–º–µ—é—Ç healthchecks:
- **Nginx:** `curl -f http://localhost:8081`
- **Redmine:** `curl -f http://localhost:3000`
- **PostgreSQL:** `pg_isready -U $POSTGRES_USER`
- **Redis:** `redis-cli ping`
- **Java Agent:** `curl -f http://localhost:8080/actuator/health`
- **Admin Panel:** `curl -f http://localhost:8000/`

### Environment Variables

**–û—Å–Ω–æ–≤–Ω—ã–µ:**
- `BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
- `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_DB`
- `REDIS_HOST`, `REDIS_PORT`
- `REDMINE_SECRET_KEY` ‚Äî —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è Rails
- `TELEGRAM_SUPERGROUP_ID` ‚Äî ID —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø—ã
- `ADMIN_PASSWORD` ‚Äî –ø–∞—Ä–æ–ª—å –¥–ª—è Admin Panel

**Redmine Email:**
- `IMAP_HOST`, `IMAP_PORT`, `IMAP_USERNAME`, `IMAP_PASSWORD`
- `SMTP_ADDRESS`, `SMTP_PORT`, `SMTP_USERNAME`, `SMTP_PASSWORD`

---

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

1. **Infrastructure:**
   - [x] Docker Compose orchestration
   - [x] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
   - [x] Healthchecks –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
   - [x] Volumes –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
   - [x] Backup service

2. **Redmine:**
   - [x] –ö–∞—Å—Ç–æ–º–Ω—ã–π Dockerfile —Å –ø–ª–∞–≥–∏–Ω–∞–º–∏
   - [x] Supervisor –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
   - [x] –ü–ª–∞–≥–∏–Ω—ã: `email_reports`, `redmine_issue_guard`, `recurring_tasks`
   - [x] –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

3. **Python Bot:**
   - [x] RBAC middleware
   - [x] Topic routing
   - [x] Redis listener
   - [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - [x] –ö–æ–º–∞–Ω–¥—ã: `/start`, `/admin`, `/set_topic`, `/cookie`

4. **Java Agent:**
   - [x] Dynamic scheduling
   - [x] Alert dispatching
   - [x] Redis event listener
   - [x] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ö–æ—Å—Ç–æ–≤ (ping)

5. **Admin Panel:**
   - [x] Dashboard
   - [x] Container management
   - [x] Target CRUD
   - [x] Backup management
   - [x] Simple auth

6. **Database:**
   - [x] RBAC schema
   - [x] Telegram topics mapping
   - [x] Monitored targets

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **Python Bot:**
   - ‚úÖ `ModuleNotFoundError: No module named 'src'` ‚Üí –¥–æ–±–∞–≤–ª–µ–Ω `PYTHONPATH=/app`
   - ‚úÖ `ProgrammingError: type "userrole" does not exist` ‚Üí –∏—Å–ø—Ä–∞–≤–ª–µ–Ω Enum mapping (`name="user_role"`)
   - ‚úÖ Redis connection errors ‚Üí –¥–æ–±–∞–≤–ª–µ–Ω—ã —è–≤–Ω—ã–µ `REDIS_HOST` –∏ `REDIS_PORT`

2. **Redmine:**
   - ‚úÖ Permission denied errors ‚Üí `chown` –≤ `init.sh` –ø–æ—Å–ª–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è volumes
   - ‚úÖ Missing secret key ‚Üí –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π (`SECRET_KEY_BASE`)
   - ‚úÖ Plugin loading ‚Üí –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

3. **Admin Panel:**
   - ‚úÖ `psycopg2-binary` build failure ‚Üí –¥–æ–±–∞–≤–ª–µ–Ω—ã `build-essential`, `libpq-dev`
   - ‚úÖ SQLAlchemy compatibility ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å–∏—è –¥–æ 2.0.36+

### üìù –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **Admin Panel Auth:** MVP —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è, —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–º–µ–Ω–∞ –Ω–∞ production-ready —Ä–µ—à–µ–Ω–∏–µ
2. **Docker Socket:** –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `/var/run/docker.sock` ‚Äî security risk
3. **Error Handling:** –ë–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
4. **Testing:** –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç unit/integration —Ç–µ—Å—Ç—ã
5. **Documentation:** –ß–∞—Å—Ç–∏—á–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–¥–∞

### üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Topics –≤ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–µ
2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ RBAC —Å–∏—Å—Ç–µ–º—ã
3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ–º –∞–∫—Ç–∏–≤–æ–≤
4. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è weekly metrics
5. –£–ª—É—á—à–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Admin Panel

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞

- **–Ø–∑—ã–∫–∏:** Python, Java, Ruby, SQL, Shell
- **–§—Ä–µ–π–º–≤–æ—Ä–∫–∏:** Aiogram, Spring Boot, FastAPI, Rails
- **–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL 17, Redis 7.4
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:** 8 —Å–µ—Ä–≤–∏—Å–æ–≤
- **–ü–ª–∞–≥–∏–Ω—ã Redmine:** 3 (2 –∫–∞—Å—Ç–æ–º–Ω—ã—Ö, 1 external)
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~3000+ (–æ—Ü–µ–Ω–∫–∞)
- **–ö–æ–º–º–∏—Ç–æ–≤:** –ê–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

---

## üîÑ Workflow –ø—Ä–∏–º–µ—Ä—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ monitored target

1. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Admin Panel (`http://localhost:8000`)
2. –í–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ: name, hostname, interval
3. –ù–∞–∂–∏–º–∞–µ—Ç "Create Target"
4. Admin Panel —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `monitored_targets` —Ç–∞–±–ª–∏—Ü—É
5. –ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ `CONFIG_UPDATE:MONITORING` –≤ Redis
6. Java Agent –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ `RedisEventListener`
7. `DynamicSchedulerService.refreshSchedule()` –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç targets –∏–∑ –ë–î
8. –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π scheduled task –¥–ª—è ping-–ø—Ä–æ–≤–µ—Ä–æ–∫

### –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–∞ –≤ Telegram

1. Java Agent –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç, —á—Ç–æ —Ö–æ—Å—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (ping failed)
2. `AlertDispatcher.sendAlert("monitoring", "üö® ALERT: Host X is DOWN!")`
3. –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Redis –∫–∞–Ω–∞–ª `bot_alerts`: `"monitoring|üö® ALERT: Host X is DOWN!"`
4. Python Bot –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ `redis_listener()`
5. –ü–∞—Ä—Å–∏—Ç —Ñ–æ—Ä–º–∞—Ç: `topic_name, text = data.split("|", 1)`
6. –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `thread_id` –¥–ª—è —Ç–æ–ø–∏–∫–∞ `monitoring` –∏–∑ –ë–î
7. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram Supergroup –≤ –Ω—É–∂–Ω—ã–π Topic

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/admin`
2. `RoleMiddleware` –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `flags={"role": UserRole.SENIOR_ADMIN}`
4. –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î –ø–æ `telegram_id`
5. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî —Å–æ–∑–¥–∞–µ—Ç —Å —Ä–æ–ª—å—é `USER`
6. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç: `user.role >= SENIOR_ADMIN`
7. –ï—Å–ª–∏ –¥–∞ ‚Äî –ø–µ—Ä–µ–¥–∞–µ—Ç –≤ handler, –∏–Ω–∞—á–µ ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç "Access Denied"

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –í–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**Python Bot:**
- `aiogram>=3.3.0`
- `sqlalchemy>=2.0.25`
- `asyncpg>=0.29.0`
- `redis>=5.0.1`

**Java Agent:**
- Spring Boot 3.4.1
- Java 21
- PostgreSQL Driver (runtime)

**Admin Panel:**
- `fastapi` (latest)
- `sqlalchemy>=2.0.36`
- `psycopg2-binary`
- `docker` (Python SDK)

**Redmine:**
- Redmine 6.0 (Alpine)
- Ruby gems: `whenever`, `chronic`, `mail`, `pg`

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `docker-compose.yml` ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è
- `config/nginx.conf` ‚Äî Nginx proxy
- `config/database.yml` ‚Äî Redmine DB
- `config/configuration.yml` ‚Äî Redmine app config
- `config/init_rbac.sql` ‚Äî RBAC schema
- `env.example` ‚Äî —à–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 2025-01-XX  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** 3.0  
**–°—Ç–∞—Ç—É—Å:** Production-Ready (MVP)

