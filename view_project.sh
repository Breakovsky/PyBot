#!/bin/bash

# ==============================================================================
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
# –ò—Å–∫–ª—é—á–∞–µ—Ç: .git, legacy, logs –∏ –±–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã
# ==============================================================================

# –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏)
EXCLUDE_DIRS=("legacy" "logs" ".git" "node_modules")

# –§–æ—Ä–º–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è find
FIND_ARGS=()
for dir in "${EXCLUDE_DIRS[@]}"; do
    FIND_ARGS+=( "-name" "$dir" "-prune" "-o" )
done

# –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –ø–æ–∏—Å–∫–∞
# -type d (...) -prune : –∏—Å–∫–ª—é—á–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
# -type f -print0      : –Ω–∞—Ö–æ–¥–∏—Ç —Ñ–∞–π–ª—ã –∏ –≤—ã–≤–æ–¥–∏—Ç –∏—Ö —Å –Ω—É–ª–µ–≤—ã–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º (–¥–ª—è –ø—É—Ç–µ–π —Å –ø—Ä–æ–±–µ–ª–∞–º–∏)
find . -type d \( "${FIND_ARGS[@]}" -false \) -o -type f -print0 | sort -z | while IFS= read -r -d '' file; do
    
    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∞–º —Å–∫—Ä–∏–ø—Ç, –µ—Å–ª–∏ –æ–Ω –ª–µ–∂–∏—Ç –≤ —ç—Ç–æ–π –∂–µ –ø–∞–ø–∫–µ
    if [[ "$file" == "./$(basename "$0")" ]]; then continue; fi

    # –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
    echo "################################################################################"
    echo "üìÑ FILE: $file"
    echo "################################################################################"

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª (grep -I –∏—â–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–∞—Ö)
    # –ï—Å–ª–∏ —Ñ–∞–π–ª –ø—É—Å—Ç–æ–π –∏–ª–∏ –±–∏–Ω–∞—Ä–Ω—ã–π ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –≤—ã–≤–æ–¥ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
    if [[ -s "$file" ]] && grep -Iq . "$file"; then
        cat "$file"
    elif [[ ! -s "$file" ]]; then
         echo "[EMPTY FILE]"
    else
         echo "[BINARY FILE - SKIPPED]"
    fi

    echo -e "\n\n"
done
