{% extends 'base.html' %}

{% block title %}Подтверждение • SoftBot Admin{% endblock %}
{% block body_class %}auth-page{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-background">
        <div class="bg-gradient"></div>
        <div class="bg-grid"></div>
        <div class="floating-shapes">
            <div class="shape shape-1"></div>
            <div class="shape shape-2"></div>
            <div class="shape shape-3"></div>
        </div>
    </div>
    
    <div class="auth-card">
        <div class="auth-header">
            <div class="logo">
                <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                    <rect width="48" height="48" rx="12" fill="url(#logo-gradient2)"/>
                    <path d="M24 14V24L30 28" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="24" cy="24" r="10" stroke="white" stroke-width="3"/>
                    <defs>
                        <linearGradient id="logo-gradient2" x1="0" y1="0" x2="48" y2="48">
                            <stop offset="0%" stop-color="#10b981"/>
                            <stop offset="100%" stop-color="#059669"/>
                        </linearGradient>
                    </defs>
                </svg>
            </div>
            <h1>Введите код</h1>
            <p class="subtitle">Код отправлен на <strong>{{ email }}</strong></p>
        </div>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <form method="POST" class="auth-form">
            <div class="form-group">
                <label for="code">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <rect x="2.5" y="8.33333" width="15" height="9.16667" rx="2" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M5.83333 8.33333V5.83333C5.83333 3.99239 7.32572 2.5 9.16667 2.5H10.8333C12.6743 2.5 14.1667 3.99239 14.1667 5.83333V8.33333" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        <circle cx="10" cy="12.9167" r="1.25" fill="currentColor"/>
                    </svg>
                    Код подтверждения
                </label>
                <input type="text" id="code" name="code" 
                       placeholder="000000" 
                       maxlength="6" 
                       pattern="[0-9]{6}"
                       inputmode="numeric"
                       required autocomplete="one-time-code"
                       autofocus
                       class="code-input">
                <span class="hint">Код действителен 10 минут</span>
            </div>
            
            <button type="submit" class="btn btn-primary btn-full">
                <span>Войти</span>
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M4.16667 10H15.8333M15.8333 10L10.8333 5M15.8333 10L10.8333 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </form>
        
        <div class="auth-actions">
            <button type="button" id="resend-btn" class="btn btn-ghost" onclick="resendCode()">
                Отправить код повторно
            </button>
            <a href="{{ url_for('login') }}" class="btn btn-ghost">
                Изменить email
            </a>
        </div>
    </div>
</div>

<script>
async function resendCode() {
    const btn = document.getElementById('resend-btn');
    btn.disabled = true;
    btn.innerHTML = 'Отправка...';
    
    try {
        const response = await fetch('/resend-code', { method: 'POST' });
        const data = await response.json();
        
        if (data.success) {
            btn.innerHTML = '✓ Код отправлен';
            setTimeout(() => {
                btn.innerHTML = 'Отправить код повторно';
                btn.disabled = false;
            }, 30000);
        } else {
            btn.innerHTML = data.message;
            btn.disabled = false;
        }
    } catch (e) {
        btn.innerHTML = 'Ошибка';
        btn.disabled = false;
    }
}
</script>
{% endblock %}

