{% extends 'base.html' %}

{% block title %}Установка пароля • SoftBot Admin{% endblock %}
{% block body_class %}auth-page{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-background">
        <div class="bg-gradient"></div>
        <div class="bg-grid"></div>
        <div class="floating-shapes">
            <div class="shape shape-1"></div>
            <div class="shape shape-2"></div>
            <div class="shape shape-3"></div>
        </div>
    </div>
    
    <div class="auth-card">
        <div class="auth-header">
            <div class="logo">
                <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                    <rect width="48" height="48" rx="12" fill="url(#logo-gradient-pwd)"/>
                    <rect x="12" y="18" width="24" height="16" rx="2" stroke="white" stroke-width="2"/>
                    <path d="M20 24L22 26L28 20" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <defs>
                        <linearGradient id="logo-gradient-pwd" x1="0" y1="0" x2="48" y2="48">
                            <stop offset="0%" stop-color="#8b5cf6"/>
                            <stop offset="100%" stop-color="#6366f1"/>
                        </linearGradient>
                    </defs>
                </svg>
            </div>
            <h1>Установка пароля</h1>
            <p class="subtitle">Создайте пароль для быстрого входа</p>
        </div>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <form method="POST" class="auth-form">
            <div class="form-group">
                <label for="password">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <rect x="2.5" y="8.33333" width="15" height="9.16667" rx="2" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M5.83333 8.33333V5.83333C5.83333 3.99239 7.32572 2.5 9.16667 2.5H10.8333C12.6743 2.5 14.1667 3.99239 14.1667 5.83333V8.33333" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        <circle cx="10" cy="12.9167" r="1.25" fill="currentColor"/>
                    </svg>
                    Новый пароль
                </label>
                <input type="password" id="password" name="password" 
                       placeholder="Минимум 8 символов" 
                       required autocomplete="new-password"
                       autofocus minlength="8">
                <span class="hint">Пароль должен содержать минимум 8 символов</span>
            </div>
            
            <div class="form-group">
                <label for="password_confirm">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M16.25 6.25L8.75 13.75L3.75 8.75" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Подтвердите пароль
                </label>
                <input type="password" id="password_confirm" name="password_confirm" 
                       placeholder="Повторите пароль" 
                       required autocomplete="new-password"
                       minlength="8">
            </div>
            
            <button type="submit" class="btn btn-primary btn-full">
                <span>Установить пароль</span>
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M4.16667 10H15.8333M15.8333 10L10.8333 5M15.8333 10L10.8333 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </form>
        
        <div class="auth-actions">
            <a href="{{ url_for('dashboard') }}" class="btn btn-ghost">
                Пропустить (установить позже)
            </a>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const password = document.getElementById('password');
    const passwordConfirm = document.getElementById('password_confirm');
    const form = document.querySelector('form');
    
    function validatePasswords() {
        if (password.value && passwordConfirm.value) {
            if (password.value !== passwordConfirm.value) {
                passwordConfirm.setCustomValidity('Пароли не совпадают');
            } else {
                passwordConfirm.setCustomValidity('');
            }
        }
    }
    
    password.addEventListener('input', validatePasswords);
    passwordConfirm.addEventListener('input', validatePasswords);
});
</script>
{% endblock %}

