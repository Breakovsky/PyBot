# Миграция настроек из .env в БД

## Цель
Перенести максимальное количество настроек из `.env` в базу данных, оставив в `.env` только секретные данные.

## Что остаётся в .env (секретные данные)

### Обязательные
- `TOKEN` - Токен Telegram бота (секрет)
- `DB_PASSWORD` - Пароль базы данных (секрет)

### Опциональные (секреты)
- `OTRS_PASSWORD` - Пароль для OTRS API (секрет)
- `SMTP_USER` - Email для отправки писем (может быть секретом)
- `SMTP_PASSWORD` - Пароль SMTP (секрет)
- `EXCEL_PASSWORD` - Пароль для Excel файла (секрет)
- `DOMAIN_BIND_PASSWORD` - Пароль для подключения к Active Directory (секрет)

### Для первоначального подключения к БД
- `DB_HOST` - Хост PostgreSQL (по умолчанию: localhost)
- `DB_PORT` - Порт PostgreSQL (по умолчанию: 5432)
- `DB_NAME` - Имя базы данных (по умолчанию: tbot)
- `DB_USER` - Пользователь базы данных (по умолчанию: tbot)

**Примечание:** Настройки БД также сохраняются в БД для отображения в веб-интерфейсе, но для первоначального подключения используются из .env.

## Что переносится в БД

### Telegram настройки
- `TELEGRAM_CHAT_ID` - ID группового чата
- `EXCEL_TOPIC_ID` - ID топика для поиска сотрудников
- `PING_TOPIC_ID` - ID топика для мониторинга
- `BOT_TOPIC_ID` - ID топика для сообщений бота
- `METRICS_TOPIC_ID` - ID топика для метрик
- `TASKS_TOPIC_ID` - ID топика для заявок OTRS
- `BOT_STARTUP_MESSAGE` - Сообщение при запуске
- `ALLOWED_THREADS` - Разрешенные топики

### Настройки удаления сообщений
- `USER_MESSAGE_DELETE_DELAY` - Задержка удаления сообщений пользователей (секунды)
- `EXCEL_MESSAGE_DELETE_DELAY` - Задержка удаления в Excel топике (секунды)
- `BOT_MESSAGE_DELETE_DELAY` - Задержка удаления сообщений бота (секунды)

### OTRS настройки (не секретные)
- `OTRS_URL` - URL OTRS сервера
- `OTRS_USERNAME` - Логин для OTRS API
- `OTRS_WEBSERVICE` - Имя Web Service

### SMTP настройки (не секретные)
- `SMTP_HOST` - SMTP сервер
- `SMTP_PORT` - SMTP порт
- `SMTP_FROM_NAME` - Имя отправителя
- `SMTP_USE_TLS` - Использовать TLS (true/false)

### Active Directory настройки
- `DOMAIN_SERVER` - IP или FQDN контроллера домена
- `DOMAIN_PORT` - Порт LDAP
- `DOMAIN_BASE_DN` - Base DN
- `DOMAIN_BIND_DN` - Bind DN

### Пути к файлам
- `EXCEL_FILE_PATH` - Путь к Excel файлу с данными сотрудников
- `IP_ADDRESSES_PATH` - Путь к XML файлу с IP адресами

### Мониторинг
- `MONITOR_CHECK_INTERVAL` - Интервал проверки серверов (секунды)
- `OTRS_CHECK_INTERVAL` - Интервал проверки новых тикетов (секунды)

### База данных (для отображения в веб-интерфейсе)
- `DB_HOST` - Хост PostgreSQL
- `DB_PORT` - Порт PostgreSQL
- `DB_NAME` - Имя базы данных
- `DB_USER` - Пользователь базы данных
- `DB_POOL_MIN_SIZE` - Минимальный размер пула
- `DB_POOL_MAX_SIZE` - Максимальный размер пула

## Как использовать

1. Запустите миграцию: `.\bot.ps1 migrate`
2. Инициализируйте настройки: `.\bot.ps1 init-settings`
3. Настройки будут загружены из .env в БД при первом запуске
4. После этого можно редактировать настройки через веб-интерфейс или скрипт `scripts/update_settings.py` (если будет создан)

## Обратная совместимость

Код поддерживает fallback на .env, если настройка не найдена в БД. Это обеспечивает плавную миграцию.

