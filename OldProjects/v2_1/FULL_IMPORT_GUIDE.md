# Полный импорт данных из Excel 1 в 1

## Проблема

При импорте не все данные попадают в БД, некоторые записи теряются или объединяются.

## Решение

Импорт теперь работает так:
- **Каждая строка Excel = отдельная запись в БД**
- Даже если ФИО повторяется, создается новая запись (может быть разная WS/отдел)
- Импортируются ВСЕ строки, где есть хотя бы какая-то информация

## Как сделать полный переимпорт

### Вариант 1: Очистить и импортировать заново (рекомендуется)

```powershell
# 1. Очистить таблицу сотрудников
.\bot.ps1 clear-employees

# 2. Импортировать данные заново
python scripts\import_employees.py "S:\Projects\tbot\v2_0\main\server\all_pc.xlsx"
```

### Вариант 2: Импортировать без очистки

```powershell
# Просто запустить импорт - он обновит существующие и добавит новые
python scripts\import_employees.py "S:\Projects\tbot\v2_0\main\server\all_pc.xlsx"
```

## Что изменилось в импорте

1. **Импорт всех строк:**
   - Импортируются все строки, где есть хотя бы одно значение
   - Если нет ФИО, но есть WS или отдел - используется как идентификатор

2. **Уникальность по комбинации:**
   - Дубликаты определяются по комбинации: ФИО + WS + Отдел
   - Один человек с разными WS = разные записи
   - Один человек в разных отделах = разные записи

3. **Улучшенная отчетность:**
   - Показывается прогресс каждые 50 записей
   - Подсчитываются пропущенные пустые строки

## Проверка после импорта

```powershell
# Проверить количество сотрудников
.\bot.ps1 check-employees

# Проверить дубликаты (если нужно)
.\bot.ps1 check-duplicates
```

## Важно

- После очистки (`clear-employees`) все данные будут удалены
- При импорте создаются новые записи для каждой строки Excel
- Если в Excel 620 строк, в БД должно быть ~620 записей (минус полностью пустые)

## Пример использования

```powershell
# 1. Проверить текущее состояние
.\bot.ps1 check-employees

# 2. Очистить таблицу (если нужно полное обновление)
.\bot.ps1 clear-employees
# Ответить "yes" на подтверждение

# 3. Импортировать данные
python scripts\import_employees.py "S:\Projects\tbot\v2_0\main\server\all_pc.xlsx"

# 4. Проверить результат
.\bot.ps1 check-employees
```

## Примечания

- Импорт может занять некоторое время для больших файлов
- Прогресс показывается каждые 50 записей
- Ошибки логируются, но не останавливают импорт
- После импорта проверьте количество записей - должно совпадать с количеством строк в Excel (минус заголовки и пустые строки)

