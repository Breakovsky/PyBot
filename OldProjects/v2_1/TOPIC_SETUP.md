# Настройка TOPIC_ID для работы бота

## ✅ Настройки инициализированы!

Все необходимые TOPIC_ID сохранены в базе данных:

- **EXCEL_TOPIC_ID**: `9` - Топик для поиска сотрудников
- **PING_TOPIC_ID**: `7` - Топик для мониторинга серверов  
- **BOT_TOPIC_ID**: `5` - Топик для сообщений бота
- **METRICS_TOPIC_ID**: `69` - Топик для метрик
- **TASKS_TOPIC_ID**: `145` - Топик для заявок OTRS

## Как это работает

1. **При старте бота** настройки загружаются из БД (`core.settings`)
2. **Если настройки нет в БД** - используется значение из `.env` файла
3. **Если нет в .env** - используется значение по умолчанию

## Проверка настроек

```powershell
# Показать все настройки
.\bot.ps1 settings

# Или через Python
python scripts\show_settings.py
```

## Изменение настроек

### Способ 1: Через .env файл

1. Отредактируйте `.env` файл:
```env
EXCEL_TOPIC_ID=9
PING_TOPIC_ID=7
BOT_TOPIC_ID=5
```

2. Запустите инициализацию:
```powershell
.\bot.ps1 init-settings
```

3. Перезапустите бота:
```powershell
.\bot.ps1 restart
```

### Способ 2: Напрямую в БД

```python
from main.config.settings import get_settings

settings = get_settings()
await settings.set("EXCEL_TOPIC_ID", "9", category="telegram")
```

## Где используются TOPIC_ID

- **EXCEL_TOPIC_ID** - обработчик `handle_excel_topic_message()` ищет сотрудников
- **PING_TOPIC_ID** - обработчик `handle_ping_topic_message()` для мониторинга
- **BOT_TOPIC_ID** - отправка сообщения о запуске бота
- **TASKS_TOPIC_ID** - отправка уведомлений о новых заявках OTRS
- **METRICS_TOPIC_ID** - отправка метрик мониторинга

## Важно

- После изменения настроек **обязательно перезапустите бота**
- Настройки кэшируются на 5 минут
- Убедитесь, что ID топиков правильные (можно проверить через @userinfobot)

## Проверка работы

1. Откройте групповой чат с ботом
2. Перейдите в топик с ID из `EXCEL_TOPIC_ID` (например, 9)
3. Отправьте имя сотрудника или IP адрес
4. Бот должен ответить результатами поиска

Если не работает:
- Проверьте логи: `.\bot.ps1 logs`
- Проверьте настройки: `.\bot.ps1 settings`
- Убедитесь, что бот добавлен в группу и имеет права

