# Исправления импорта и поиска

## Проблемы, которые были исправлены

### 1. ✅ Поиск по WS - точное совпадение

**Проблема:** При поиске "WS111" находились записи типа "WS093" (потому что в "WS093" есть "111" в конце).

**Решение:**
- Добавлен метод `search_by_workstation_exact()` для точного поиска
- При поиске по WS сначала ищется точное совпадение, затем частичное
- Поиск теперь работает правильно: "WS111" находит только "WS111"

### 2. ✅ Дедупликация при импорте

**Проблема:** При импорте создавались дубликаты сотрудников с одинаковым ФИО.

**Решение:**
- При импорте проверяется существование сотрудника по ФИО
- Если найдено несколько записей, берется первая (самая старая)
- Создан скрипт `check_duplicates.py` для проверки и удаления существующих дубликатов

### 3. ✅ Улучшенная логика импорта

**Изменения:**
- При обновлении существующего сотрудника используется `ORDER BY id LIMIT 1` для выбора первой записи
- Улучшена обработка ошибок при импорте

## Использование

### Проверка дубликатов

```powershell
.\bot.ps1 check-duplicates
```

Или:

```powershell
python scripts\check_duplicates.py
```

Скрипт покажет все дубликаты и предложит их удалить (оставив первую запись).

### Проверка данных

```powershell
.\bot.ps1 check-employees
```

### Переимпорт данных (если нужно)

Если нужно переимпортировать данные с исправлениями:

```powershell
python scripts\import_employees.py "путь\к\файлу.xlsx"
```

## Что дальше

1. **Проверьте дубликаты:** `.\bot.ps1 check-duplicates`
2. **Проверьте поиск:** Отправьте "WS111" в топик Excel - должно найти только точное совпадение
3. **Если нужно переимпортировать:** Запустите импорт заново

## Примечания

- Поиск по WS теперь работает точно: "WS111" = только "WS111", "WS11" = все начинающиеся с "WS11"
- Дубликаты при импорте больше не создаются
- Существующие дубликаты можно удалить через `check-duplicates`

