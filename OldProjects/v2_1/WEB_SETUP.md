# Настройка веб-интерфейса TBot v2.1

## Быстрый старт

### 1. Создание первого пользователя

Для входа в веб-интерфейс нужно создать пользователя в БД:

```powershell
.\bot.ps1 create-user
```

Скрипт запросит:
- Email (обязательно)
- ФИО (опционально)
- Пароль (обязательно)
- Права администратора (y/n)

### 2. Запуск веб-интерфейса

Веб-интерфейс запускается автоматически вместе с ботом:

```powershell
.\bot.ps1 start
```

Веб-интерфейс будет доступен по адресу: `http://localhost:8000`

### 3. Настройка (опционально)

В `.env` файле можно настроить:

```env
WEB_ENABLED=true          # Включить/выключить веб-сервер (по умолчанию: true)
WEB_HOST=0.0.0.0         # Хост для прослушивания (по умолчанию: 0.0.0.0)
WEB_PORT=8000             # Порт (по умолчанию: 8000)
```

## Использование

1. Откройте браузер и перейдите на `http://localhost:8000`
2. Войдите используя email и пароль созданного пользователя
3. Используйте веб-интерфейс для:
   - Просмотра статистики (Дашборд)
   - Управления сотрудниками (Список ПК)
   - Настройки бота (в разработке)

## API Документация

После запуска доступна автоматическая документация:

- Swagger UI: `http://localhost:8000/api/docs`
- ReDoc: `http://localhost:8000/api/redoc`

## Безопасность

- Все API endpoints (кроме `/api/v1/auth/login`) требуют JWT токен
- Токен действителен 24 часа
- Только администраторы могут управлять настройками и сотрудниками
- Секретные настройки не могут быть изменены через API

## Управление пользователями

### Создание нового пользователя

```powershell
.\bot.ps1 create-user
```

### Обновление пароля

Если пользователь уже существует, скрипт предложит обновить пароль.

### Создание пользователя через SQL (альтернатива)

```sql
-- Создать пользователя-администратора
INSERT INTO core.users (email, password_hash, full_name, is_active, is_admin, password_set_at)
VALUES (
    'admin@yourcompany.com',
    '$2b$12$...',  -- bcrypt hash пароля (используйте Python для генерации)
    'Администратор',
    TRUE,
    TRUE,
    NOW()
);
```

Для генерации bcrypt hash:

```python
import bcrypt
password = "your_password"
hash = bcrypt.hashpw(password.encode('utf-8'), bcrypt.gensalt()).decode('utf-8')
print(hash)
```

## Устранение неполадок

### Веб-интерфейс не запускается

1. Проверьте логи: `.\bot.ps1 logs`
2. Убедитесь, что `WEB_ENABLED=true` в `.env`
3. Проверьте, что порт 8000 свободен

### Не могу войти

1. Убедитесь, что пользователь создан: `.\bot.ps1 create-user`
2. Проверьте, что пользователь активен в БД:
   ```sql
   SELECT email, is_active, is_admin FROM core.users;
   ```

### Ошибка "Token expired"

Токен действителен 24 часа. Просто войдите заново.

## Следующие шаги

1. Расширить управление настройками через веб-интерфейс
2. Добавить управление ботом (старт/стоп/перезапуск)
3. Интеграция с AD и почтой
4. Расширенная статистика и отчёты

